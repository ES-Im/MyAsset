| 속성 | 설명 |
|----|----|
|    |    |

# 도메인 모델
***

## 사용자(user)

---
## _Entity : user_
 
- 내부관리용 회원관련 비개인정보 엔티티 
####  Attribute

| 속성            | 설명         |
|---------------|------------|
| userKey        | 사용자의 내부식별자 |
| status        | 사용자 상태     | 
| role          | 관리자여부      | 
| creatAt       | 가입일자       | 
| lastLoginAt   | 마지막 로그인 일자 | 
| withdrawReqAt | 탈퇴요청일      |  

    ※ Enum : status
      · ACTIVE : 활성계정
      · WITHDRAWN : 탈퇴
      · WITHDRAW_PENDING : 탈퇴요청
      · DORMANT : 휴먼계정
    
    ※ Enum : role
      · ADMIN : 관리자
      · USER : 일반 사용자

### 행위
    - constructor(): 회원등록 (status=ACTIVE, role=USER)
    - register() : 회원등록
    - requestWithdraw(): 사용자의 회원탈퇴요청 
    - requestActive() : 사용자의 계정복구요청
    - markDormant() : 휴먼계정전환
    - markWithdraw() : 탈퇴계정전환
    - validateDelete() : USER 물리적 삭제 가능 여부 판단
    - isActive() : 활설 계정 체크

### 정책 (Batch / Scheduler)
    - markDormant: 휴먼상태변경 
    - markWithdrawn: 회원탈퇴 상태 전환 
    - deleteUser: USER 정보 물리적 삭제 

### 규칙
    ① status 변환시점
      · ACTIVE : 소셜 회원가입 즉시
      · ACTIVE → DORMANT : 1년간 미접속
      · ACTIVE → WITHDRAW_PENDING : 사용자 탈퇴요청
      · WITHDRAW_PENDING / DORMANT → ACTIVE : 소셜로그인 && 사용자 동의
      · WITHDRAW_PENDING → WITHDRAWN : 사용자 탈퇴요청 후 30일 경과
      · WITHDRAW → 물리삭제 : 탈퇴 확정 후 60일 경과

    ② 회원탈퇴 (userInfoCleanByWithdrawn)
      · 사용자는 ACTIVE상태에서 회원을 탈퇴(요청)할 수 있다.
      · WITHDRAWN 상태전환 후 60일이 지나면 해당 유저에 대한 정보(E.user) 전부 물리적으로 삭제된다.
    
    ③ 계정복구
      · 사용자가 계정복구를 요청하면 즉시 Active 상태가 된다
      · WITHDRAW_PENDING 상태에서 계정을 복구하면 '탈퇴요청일자'가 Null값이 된다. 

     

### _Entity : user_info_

- OAuth로 불러온 회원관련 개인정보 엔티티
#### Attribute
| 속성           | 설명                    |
|--------------|-----------------------|
| userKey      | 사용자의 내부식별자            |
| name         | 사용자 이름 (소셜서버에서 받은 값)  |
| email        | 사용자 이메일 (소셜서버에서 받은 값) |
| providerType | OAuth 서비스 Provider    |

    ※ Enum : providerType
      · KAKAO
      · GOOGLE
      · NAVER

### 행위
    - constructor(): 회원정보 저장
    - registerFromOAuth() : 회원 정보 등록

### 정책 (Batch / Scheduler)
    - deleteUserInfo: 회원의 개인정보 물리적으로 삭제 

### 도메인간 관계 정의
    - USER (1) --- (0..1) USER_INFO
    - User는 Aggregate Root이며, UserInfo는 User의 생명주기에 종속된다.
    User가 WITHDRAWN 상태로 전환되면 해당 User의 개인정보(UserInfo)는 정책에 따라 일정 시간이 지난 후 제거된다.

    ※ user과 userInfo 생명주기  - 삭제예정 문구 (개인 참고용)
    - 생성 : OAuthUserInfo(불변 DTO) → userInfo 생성 → user 생성
    - 소멸 : user WITHDRAWN 전환 → userInfo 소멸 -(60일뒤)→ user 소멸 



---

## 자산 (Asset)
    - 사용자가 보유한 자산종목
**Entity: AssetType**

| 속성            | 설명                             |
|---------------|--------------------------------|
| assetId       | 자산 내부식별자                       |
| user_key      | 사용자의 내부식별자(asset:user = N:1)   | 
| assetType     | 자산 종류                          | 

    ※ Enum : assetType
      · CARD : 체크카드, 신용카드
      · STOCK_ACCOUNT : 증권계좌
      · BANK_ACCOUNT : 예금계좌
      · CASH : 현금

### 행위
    - addCashAsset() : 현금 자산 추가
    - updateCashAsset() : 현금 자산 수정
    - removeCashAsset() : 현금 자산 삭제
    - syncAssets() : 자산동기화 (card, stock_account, bank_account 갱신)

### 정책 
    - isEditable() : CASH 외에는 조회전용<br>
      → CASH외에는 동기화 대상

### 도메인간 관계 정의
    - Asset (1) --- (0..N) CARD
    - Asset (1) --- (0..N) STOCK_ACCOUNT
    - Asset (1) --- (0..N) BANK_ACCOUNT
    - Asset (1) --- (0..1) CASH

### 은행계좌(bankAccount)
**entity**

| 속성            | 설명                             |
|---------------|--------------------------------|
| bankAcctId       | 은행계좌 내부식별자                       |
| asset_id      | 자산의 내부식별자(bankAccount:asset = N:1)   |
| bankCode     | 은행코드(CompanyCode)                          |
| acctNum     | 계좌 번호                          |
| balance     | 계좌 잔액                          |

    ※ Enum : bankCode(CompanyCode)
      · 금융결제원 공시 기관 코드 기준 금융 기관 코드

### 현금(cash)
**entity**

| 속성            | 설명                             |
|---------------|--------------------------------|
| cashId       | 현금장부 내부식별자                       |
| asset_id      | 자산의 내부식별자(cash:asset = N:1)   |
| balance     | 현금 잔액                        |

### 카드(Card)
**entity**

| 속성            | 설명                             |
|---------------|--------------------------------|
| cardId       | 카드 내부식별자                       |
| asset_id      | 자산의 내부식별자(Card:asset = N:1)   |
| cardCode     | 카드사 코드                        |
| cardType     | 카드 유형                        |
| billingDay     | 결제일                        |
| bankAccount     | 인출 계좌번호(미연결 계좌 시 null)                        |

    ※ Enum : cardCode
      · 금융결제원 공시 기관 코드 기준 카드사 기관 코드

    ※ Enum : cardType
      · 체크카드(debit)
      · 신용카드(credit)

### 증권계좌(stockAccount)
**entity**

| 속성            | 설명                             |
|---------------|--------------------------------|
| stockAcctId       | 증권계좌 내부식별자                       |
| asset_id      | 자산의 내부식별자(stockAccount:asset = N:1)   |
| brokerCode     | 증권사코드(CompanyCode)                          |

    ※ Enum : bankCode(CompanyCode)
      · 금융결제원 공시 기관 코드 기준 금융 기관 코드

---

## 거래내역(transactions)
**entity**

| 속성              | 설명                                  |
|-----------------|-------------------------------------|
| tran_id         | 거래내역 내부식별자                          |
| asset_id        | 자산의 내부식별자(transactions:asset = N:1) |
| cgy_id          | 카테고리 내부식별자                          |
| flowType        | 자산 유입 / 유출                          |
| payStatus       | 결제 수단                               |
| tranAmt         | 거래 금액                               |
| totalInstallCnt | 할부회차                                |
| memo            | 거래에 대한 사용자 메모                       |

    ※ Enum : payStatus(거래 승인상태)
      · APPROVED("01", "승인"),
      · CANCELLED("02", "승인취소")
      · CORRECTED("03", "정정")
      · NO_AUTH("04", "무승인매입")

    ※ Enum : flowType 
      · INFLOW 자산 유입 
      · OUTFLOW 자산 유출

### 행위
    - createTransaction()
    - updateTransaction()
    - deleteTransaction()

### 정책
    - transactionClean<br>
     : 사용자가 WITHDRAWN 상태 전환 후 60일이 지나면 해당 유저에 대한 거래내역이 전부 물리적으로 삭제된다.

### 규칙
    - isPositive() : 입력된 값은 양수여야한다.
    - isFuture() : 입력된 날은 미래가 될 수 없다.
    - checkEditablePayType() : 메모 제외 현금만 직접 수정이 가능하다.
    - 

### 도메인간 관계 정의
    - Transactions (1) --- (0..N) TransactionFile
    - Transactions (1..N) --- (1) CATEGORY
    - Transactions (1..N) --- (1) ASSET

### 거래내역 첨부파일 (transactionFile)
| 속성                  | 설명                                             |
|---------------------|------------------------------------------------|
| file_Id             | 거래내역 첨부파일 내부식별자                                |
| tran_id             | 거래내역 내부식별자(transactionFile:transactions = N:1) |
| sourceFileName      | 원본 파일명                                         |
| destinationFileName | 저장되는 파일 명(UUID 조합)                             |
| ext                 | 파일 확장자 명                                       |
| size                | 파일 크기                                          |

    ※ Enum : EXT 
      · 허용가능한 확장자 명 
      · JPG
      · PNG
      · JPEG
      · GIF
      · WEBP


### 규칙
    - checkExt() : 허용한 확장자인지 검토
    - checkSize() : 10MB 이하인지 검토

### 정책
    - tranFileCleanByDeleteTran() : 거래를 삭제하면 하위의 첨부파일도 삭제된다


### 예산(budget)
**entity*
| 속성                  | 설명                                             |
|---------------------|------------------------------------------------|
| budget_Id             | 예산 내부식별자                                |
| user_key             | 사용자의 내부식별자(budget:user = N:1) |
| isAutoGenerated  | 예산 자동생성여부 |
| year      | 대상 연                                         |
| month | 대상 월                         |
| cgy_id                 | 카테고리 내부식별자                                       |
| amt                | 예산 지출액                                          |


  ---- 여기서 부터 이어서 예산 자동생성여부 관련 고민해봐야함
엔티티를 새로 만들어서 관리할건지 (notification_rule 처럼)
예산 자동설정에 대해서도 요구사항 빠진 부분있음 
1. 과거 소비이력이 충분치 않으면 80%로
2. 충분하면 평균치로 


### 카테고리(category)
**entity**

### 보유주식종목(Holding)
**entity**

### 주식종목뉴스(news)
**entity**

### 알림(alarm)
**entity**

### 자산 포트폴리오(asset portfolio)

### 로그(log)